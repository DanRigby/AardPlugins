<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Tuesday, October 05, 2021, 10:42 AM -->
<!-- MuClient version 5.07-pre -->

<!-- Plugin "RnameWithGMCP" generated by Plugin Wizard -->

<muclient>
<plugin
   name="RnameWithGMCP"
   author="Crowley,fizix"
   id="8a7ff1c8cf6e889324b26e7e"
   language="Lua"
   purpose="Displays GMCP room ID and area keyword"
   save_state="y"
   date_written="2021-10-05 10:41:05"
   requires="4.80"
   version="1.1"
   >

</plugin>

<triggers>
  <trigger
   enabled="y"
   keep_evaluating="y"
   match="{rname}*"
   omit_from_output="y"
   send_to="14"
   sequence="100"
  >
  <send>TSRtable = TriggerStyleRuns</send>
  </trigger>
</triggers>

<aliases>
  <alias
	enabled="y"
	keep_evaluating="y"
	match="roomids"
	send_to="12"
	sequence="100"
  >
  <send>idEnabled = not idEnabled
		SetVariable("idEnabled", tostring(idEnabled))
		ColourNote("white", "blue", "Room IDs are now " .. (tostring(idEnabled) == "true" and "enabled" or "disabled") .. "!")</send>
  </alias>

	<alias
	enabled="y"
	keep_evaluating="y"
	match="roomarea"
	send_to="12"
	sequence="100"
	>
	<send>areaEnabled = not areaEnabled
		SetVariable("areaEnabled", tostring(areaEnabled))
		ColourNote("white", "blue", "Room area is now " .. (tostring(areaEnabled) == "true" and "enabled" or "disabled") .. "!")</send>
	</alias>
</aliases>

<!--  Script  -->


<script>
<![CDATA[
require "gmcphelper"

idEnabled = GetVariable("idEnabled") or "true"
areaEnabled = GetVariable("areaEnabled") or "true"

TSRtable = {}

function OnPluginBroadcast(msg, id, name, text)
	if (id == "3e7dedbe37e44942dd46d264") then
		if (text == "room.info") then
			for i,v in pairs(TSRtable) do
				if v.text ~= "{rname}" then
					ColourTell (RGBColourToName (v.textcolour),
					RGBColourToName (v.backcolour),
					v.text)
				    break;
				end
			end
			if tostring(areaEnabled) == "true" then
				local areaKeyword = gmcp("room.info.zone")
				if areaKeyword and areaKeyword ~= "" then
					ColourTell("black", "black", " ")
					Hyperlink ("mapper goto 32418;runto " .. areaKeyword,
									"[" .. areaKeyword .. "]",
									"Run to " .. areaKeyword .. "",
									"cyan", "black", 0)
				end
			end
			if tostring(idEnabled) == "true" then
				ColourTell("black", "black", " ")
				Hyperlink ("mapper goto " .. gmcp("room.info.num"),
								"(" .. gmcp("room.info.num") .. ")",
								"",
								"white", "black", 0)
			end
			Note("")
		end
	end
end	
]]>
</script>


</muclient>
	
